---
layout: post
title: "데이터베이스 INDEX 개념 정리"
date: 2024-04-07
categories: ["CS"]
tags: ["Databse"]
comments: true
---


안녕하세요!

실무에서 테이블을 생성하거나 데이터를 조회하는 일이 빈번하게 발생합니다. 이럴 때마다 인덱스에 관한 다양한 피드백을 많이 받았습니다. 특히 용량이 큰 테이블에서는 인덱스가 얼마나 중요한 역할을 하는지를 실제 쿼리를 작성할 때마다 느끼게 됩니다. 그러므로 이번에는 정확한 개념과 원리를 숙지하여 제대로 공부해보려고 합니다!

### 인덱스의 개념 이해

데이터베이스에서 인덱스는 데이터를 빠르게 검색할 수 있도록 돕는 자료 구조입니다. 책의 색인과 같이, 특정 정보를 찾기 위해 모든 페이지를 훑어보지 않아도 되는 방식입니다. 인덱스를 사용하면 데이터베이스는 레코드를 빠르게 찾을 수 있습니다. 

### 인덱스 생성문

```sql
CREATE INDEX *index_name* ON *table_name*(*column1*, *column2*, ...);
```

### 인덱스의 종류

인덱스는 다양한 종류가 있습니다.

- **단일 인덱스(Single Index)**: 하나의 열에 대해서만 인덱스를 생성하는 방식입니다. 간단한 데이터 검색에 유용합니다. 가장 일반적인 유형의 인덱스입니다.

```sql
CREATE INDEX idx_customer_id ON customers(customer_id);
```

- **복합 인덱스(Composite Index)**: 두 개 이상의 열을 결합하여 인덱스를 생성하는 방식입니다. 복잡한 데이터 검색에 유용하며, 정확한 검색을 위해 사용됩니다.

```sql
CREATE INDEX idx_name_age ON employees(name, age)
```

- **유니크 인덱스(Unique Index)**: 인덱스의 모든 값이 고유해야 하는 경우에 사용하는 인덱스입니다.
- **클러스터형 인덱스:** 클러스터형 인덱스는 테이블의 실제 데이터가 인덱스 순서대로 저장되는 인덱스입니다. 클러스터형 인덱스는 테이블 자체의 물리적인 순서를 변경시키므로 하나의 테이블에는 한 개의 클러스터형 인덱스만 존재할 수 있습니다.

```sql
CREATE CLUSTERED INDEX index_order_date ON orders(order_date);
```

- **비클러스터형 인덱스(Non-Clustered Index):** 데이터베이스의 실제 데이터와 인덱스가 별도로 저장되는 인덱스입니다. 테이블의 물리적 순서를 변경시키지 않으며 하나의 테이블에 여러 개의 비클러스터형 인덱스를 생성할 수 있습니다.

```sql
CREATE IDNEX idx_product_name ON products(product_name); 
```

### 인덱스의 작동 방식

인덱스가 없는 테이블을 조회할 때 DB는 전체 테이블을 순차적으로 스캔을 합니다. 그러면 전체 데이터를 한 번씩 읽어야 하기 때문에 시간 복잡도는 O(n) 입니다.

만약 인덱스를 가지고 있고 인덱스를 사용하여 조회를 한다면, 이진 검색(Binary Search)를 통해 시간 복잡도는 O(log n)이 됩니다. 

인덱스에 사용되는 주요 알고리즘은 B-Tree 입니다. 

[출처 : https://www.programiz.com/dsa/b-tree](https://eunmik.github.io/bonita.github.io/assets/img/2024/0407/b-tree.png)



### 인덱스의 장점과 단점

인덱스는 데이터 검색속도와 쿼리 실행속도를 향상시킨다는 뚜렷한 장점이 있습니다. 

하지만 인덱스가 항상 장점만 있는 것은 아닙니다. 

**단점:** 

- 인덱스는 별도의 저장 공간을 차지하므로 데이터베이스의 크기가 커집니다.
- 데이터를 삽입, 삭제, 수정할 때마다 인덱스도 업데이트가 되어야 하기 때문에 이로 인한 오버헤드가 발생합니다.

인덱스는 검색 속도를 향상시키는데 큰 역할을 하지만 인덱스를 올바르게 설계하고 사용하는 것은 중요합니다. 

### 복합 인덱스의 순서

복합 인덱스에서 순서는 매우 중요합니다. 복합 인덱스는 두 개 이상의 열을 함께 인덱스로 지정하는데 열의 순서는 인덱스의 효율성과 검색 성능에 직접적인 영향을 미칩니다. 

가장 중요한 열을 먼저 인덱스로 설정하는 것이 좋습니다. 이는 해당 열을 사용하여 데이터를 필터링할 때 인덱스를 가장 효과적으로 사용할 수 있기 때문입니다. 

예를 들어, 복합 인덱스가 (이름, 나이)로 설정되어있다면, 이름으로 데이터를 필터링할 때 인덱스를 사용하여 검색속도를 향상시킬 수있지만 나이만으로 데이터를 필터링하는 경우에는 해당 인덱스를 사용할 수 없습니다. 

또한, 쿼리에서 사용되는 조건에 따라 인덱스의 순서를 조정할수도 있습니다. 자주 사용되는 조건이 먼저 나와야 인덱스를 최대한 활용할 수 있습니다. 

따라서, 복합 인덱스에서는 열의 순서를 신중하게 결정해야합니다. 가장 중요한 검색 조건을 먼저 나열하여 인덱스의 효율성을 극대화할 수 있습니다. 

### 인덱스로 생성해야할 컬럼 기준

아래는 주요 기준입니다. 인덱스 생성은 상황에 따라 다릅니다. 

1. 검색 빈도가 높은 컬럼 
2. 조인에 사용되는 컬럼: 테이블 간의 컬럼에 인덱스를 생성하면 조인 작업의 성능을 향상 시킬 수 있습니다. 
3. 필터링에 사용되는 컬럼: WHERE 절이나 JOIN 조건 등에 필터링에 사용되는 컬럼에 인덱스를 생성하는 것이 중요합니다. 
4. 정렬이나 그룹화에 사용되는 컬럼: ORDER BY 나 GROUP BY 절에서 사용되는 컬럼에 인덱스를 생성하여 성능을 향상 시킬 수 있습니다. 
5. 고유성이 높은 컬럼: 고유성이 높은 컬럼에 인덱스를 생성하여 중복된 값을 제거하고 유일한 값을 검색할 수 있습니다. 

## QUIZ.

1. 데이터베이스 인덱스의 주요 목적은? 
2. 클러스터형 인덱스와 비 클러스터형 인덱스의 차이는? 
3. 인덱스가 없는 상태에서 수행되는 SELECT 쿼리와 인덱스가 있는 상태에서 수행되는 SELECT 쿼리의 차이점은?
4. 다중 컬럼 인덱스는 어떤 경우에 사용하는 것이 좋을까?
5. ORDER BY 절에 사용되는 열에 인덱스가 있는 경우와 그렇지 않은 경우의 정렬 작업에 대한 성능 차이는?
6. 데이터베이스에서 인덱스를 생성할 때 고려해야 할 최적의 컬럼은? 
7. 고객 테이블이 있고, 이메일 주소를 기반으로 자주 검색되는데, 어떤 유형의 인덱스를 생성해야 하는지?
8. 주문 테이블에서 날짜 범위로 주문을 검색하는 쿼리의 성능을 향상시키기 위해 어떤 유형의 인덱스를 사용해야 하는지?
9. 대용량의 로그 테이블에서 최근 로그를 검색하는 쿼리의 성능을 향상시키기 위해 어떤 종류의 인덱스를 사용해야 하는지?
10. 주문 테이블에서 특정 고객의 주문 수를 계산하는 쿼리를 최적화하기 위해 어떤 종류의 인덱스를 사용해야 하는지?