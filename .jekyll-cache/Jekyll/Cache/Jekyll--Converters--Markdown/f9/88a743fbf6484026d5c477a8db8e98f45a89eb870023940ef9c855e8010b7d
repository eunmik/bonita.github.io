I"c<h2 id="1-ì¸ì¦-api---í”„ë¡œì íŠ¸-êµ¬ì„±-ë°-ì˜ì¡´ì„±-ì¶”ê°€">1. ì¸ì¦ API - í”„ë¡œì íŠ¸ êµ¬ì„± ë° ì˜ì¡´ì„± ì¶”ê°€</h2>

<p>ì˜ì¡´ì„± ì¶”ê°€ (pom.xml)</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-security<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

</code></pre></div></div>

<p>ì˜ì¡´ì„± ì¶”ê°€ í›„ ìë™ìœ¼ë¡œ ë¡œê·¸ì¸ í™”ë©´ì´ ì¶œë ¥ì´ ë¨ (user)</p>

<p><img src="https://eunmik.github.io/bonita.github.io/assets/img/210611-login.png" /></p>

<p>ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ì˜ì¡´ì„± ì¶”ê°€ ì‹œ ì¼ì–´ë‚˜ëŠ” ì¼ë“¤</p>

<ul>
  <li>ì„œë²„ê°€ ê¸°ë™ë˜ë©´ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ì´ˆê¸°í™” ì‘ì—… ë° ë³´ì•ˆ ì„¤ì •ì´ ì´ë£¨ì–´ì§„ë‹¤</li>
  <li>ë³„ë„ì˜ ì„¤ì •ì´ë‚˜ êµ¬í˜„ì„ í•˜ì§€ ì•Šì•„ë„ ê¸°ë³¸ì ì¸ ì›¹ ë³´ì•ˆ ê¸°ëŠ¥ì´ í˜„ì¬ ì‹œìŠ¤í…œì— ì—°ë™ë˜ì–´ ì‘ë™í•¨
    <ol>
      <li>ëª¨ë“  ìš”ì²­ì€ ì¸ì¦ì´ ë˜ì–´ì•¼ ìì›ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•œë‹¤.</li>
      <li>ì¸ì¦ ë°©ì‹ì€ í¼ ë¡œê·¸ì¸ ë°©ì‹ê³¼ httpBasic ë¡œê·¸ì¸ ë°©ì‹ì„ ì œê³µí•œë‹¤.</li>
      <li>ê¸°ë³¸ ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ì œê³µí•œë‹¤.</li>
      <li>ê¸°ë³¸ ê³„ì • í•œ ê°œ ì œê³µí•œë‹¤ - username:user / password : ëœë¤ë¬¸ìì—´</li>
    </ol>
  </li>
</ul>

<p>ë¬¸ì œì </p>

<ul>
  <li>ê³„ì •ì¶”ê°€, ê¶Œí•œ ì¶”ê°€, DBì—°ë™ ë“±</li>
  <li>ê¸°ë³¸ì ì¸ ë³´ì•ˆ ê¸°ëŠ¥ ì™¸ì— ì‹œìŠ¤í…œì—ì„œ í•„ìš”ë¡œ í•˜ëŠ” ë” ì„¸ë¶€ì ì´ê³  ì¶”ê°€ì ì¸ ë³´ì•ˆê¸°ëŠ¥ì´ í•„ìš”</li>
</ul>

<h2 id="2-ì‚¬ìš©ì-ì •ì˜-ë³´ì•ˆ-ê¸°ëŠ¥-êµ¬í˜„">2. ì‚¬ìš©ì ì •ì˜ ë³´ì•ˆ ê¸°ëŠ¥ êµ¬í˜„</h2>

<p><img src="https://eunmik.github.io/bonita.github.io/assets/img/210611-img1.JPG" /></p>

<p><strong>WebSecurityConfigurerAdapter</strong> ëŠ”</p>

<p>ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ì›¹ ë³´ì•ˆ ê¸°ëŠ¥ì„ ì´ˆê¸°í™” í•˜ê³  ì„¤ì •í•˜ëŠ” í´ë˜ìŠ¤ì´ë‹¤.</p>

<p>WebSecurityConfigurerAdapterê°€ HttpSecurityë¥¼ ìƒì„±í•˜ê³  HttpSecurityì—ì„œëŠ” ì„¸ë¶€ì ì¸ ë³´ì•ˆ ê¸°ëŠ¥ì„ ì„¤ì •í•  ìˆ˜ ìˆëŠ” APIë¥¼ ì œê³µí•˜ê³  ìˆë‹¤.</p>

<p>ì‚¬ìš©ì ì •ì˜ ë³´ì•ˆ ì„¤ì • í´ë˜ìŠ¤ë¼ëŠ” SecurityConfigë¥¼ ë§Œë“¤ì–´ì„œ WebSecurityConfigurerAdapterë¥¼ ìƒì† ë°›ì•„ì„œ HttpSecurityë¡œ ì„¸ë¶€ì ì´ê³  ì¶”ê°€ì ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆë„ë¡ í•  ì˜ˆì •ì´ë‹¤.</p>

<p>org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</p>

<p>ì´ í´ë˜ìŠ¤ë¥¼ ìƒì†ì„ ë°›ì•„ì„œ configure ë©”ì†Œë“œë¥¼ overrideí•˜ë©´ ìš°ë¦¬ë§Œì˜ ë³´ì•ˆ ì„¤ì •ì„ í•  ìˆ˜ ìˆìŒ</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Using default configure(HttpSecurity). If subclassed this will potentially override subclass configure(HttpSecurity)."</span><span class="o">);</span>
        <span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">((</span><span class="n">requests</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span> 
            <span class="o">((</span><span class="nc">AuthorizedUrl</span><span class="o">)</span><span class="n">requests</span><span class="o">.</span><span class="na">anyRequest</span><span class="o">()).</span><span class="na">authenticated</span><span class="o">();</span> <span class="c1">//ì–´ë–¤ ìš”ì²­ì—ë„ ì¸ì¦ì„ ìš”êµ¬í•˜ê² ë‹¤.</span>
        <span class="o">});</span>
        <span class="n">http</span><span class="o">.</span><span class="na">formLogin</span><span class="o">();</span> <span class="c1">//formLogin ë°©ì‹ê³¼</span>
        <span class="n">http</span><span class="o">.</span><span class="na">httpBasic</span><span class="o">();</span> <span class="c1">//httpBasic ë°©ì‹ì˜ ì¸ì¦ì„ ìš”êµ¬í•œë‹¤. </span>
    <span class="o">}</span>
</code></pre></div></div>

<p>ì‚¬ìš©ì ì •ì˜ ë³´ì•ˆ ì„¤ì •</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableWebSecurity</span> <span class="c1">//WebSecurityConfiguration, SpringWebMvcImportSelector, OAuth2ImportSelector., HttpSecurityConfiguration í´ë˜ìŠ¤ë¥¼ importë°›ì€ annotation</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span> <span class="c1">//ì¸ê°€ ì •ì±…</span>
                <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span> <span class="c1">//ìš”ì²­ì—ëŒ€í•œ ë³´ì•ˆê²€ìƒ‰</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">();</span> <span class="c1">//ì–´ë–¤ ìš”ì²­ì—ë„ ì¸ì¦ì„ ë°›ë„ë¡</span>

        <span class="n">http</span> <span class="c1">//ì¸ì¦ ì •ì±…</span>
                <span class="o">.</span><span class="na">formLogin</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ì‚¬ìš©ì ì •ì˜ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • (pom.xml)</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spring.security.user.name=user
spring.security.user.password=user
</code></pre></div></div>

<h2 id="3-ì¸ì¦-api---form-ì¸ì¦">3. ì¸ì¦ API - Form ì¸ì¦</h2>

<p><img src="https://eunmik.github.io/bonita.github.io/assets/img/210611-img2.JPG" /></p>

<p>ì¸ì¦ì²˜ë¦¬ ê´€ë ¨ëœ ê°ì²´ê°€ ìƒì„±ë˜ê³  ì €ì¥ë˜ëŠ” ê³¼ì •</p>

<ol>
  <li>ì‚¬ìš©ìê°€ get ë°©ì‹ìœ¼ë¡œ form urlë¡œ ìì›ì— ì ‘ê·¼ì„ ì‹œë„</li>
  <li>ServerëŠ” ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤ê³  ë³´ì•ˆì´ ì„¤ì •ë˜ì–´ ìˆë‹¤</li>
  <li>í˜„ì¬ ì‚¬ìš©ìê°€ ì¸ì¦ì´ ë˜ì§€ ì•Šì€ ê²½ìš°ì—ëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ëœë‹¤</li>
  <li>username + passwordë¥¼ ì…ë ¥í•˜ê³  POST ë°©ì‹ìœ¼ë¡œ ë‹¤ì‹œ ì¸ì¦ì„ ì‹œë„ í•œë‹¤</li>
  <li>serverì—ì„œëŠ” ì‹œíë¦¬í‹°ê°€ session idë¥¼ ìƒì„±í•˜ê²Œ ë˜ê³ </li>
  <li>ì•ì— sessionì— ìµœì¢… ì„±ê³µí•œ ì¸ì¦ ê²°ê³¼ë¥¼ ë‹´ì€ ì¸ì¦í† í°(Authentication íƒ€ì…ì˜ í´ë˜ìŠ¤)ì„ ìƒì„±í•œë‹¤</li>
  <li>Security Context(ë‚˜ì¤‘ì— ê³µë¶€í•˜ê²Œ ë ) ë¥¼ ìƒì„±í•˜ê²Œ ë˜ê³  ì„¸ì…˜ì— ì €ì¥í•œë‹¤.</li>
  <li>ì¸ì¦ì„ ë°›ì€ ì´ í›„ì— ì‚¬ìš©ìê°€ home URLë¡œ ìì›ì— ì ‘ê·¼ì„ ì‹œë„í•˜ë©´ Spring SecurityëŠ” í˜„ì¬ ì‚¬ìš©ìê°€ ê°€ì§„ sessionìœ¼ë¡œ ë¶€í„° ì¸ì¦ í† í°ì˜ ì¡´ì¬ ì—¬ë¶€ë¥¼ íŒë‹¨</li>
  <li>ê·¸ ì‚¬ìš©ìëŠ” ì¸ì¦ í† í°ìœ¼ë¡œ ê³„ì†ì ìœ¼ë¡œ í•´ë‹¹ ìì›ì— ì ‘ê·¼í•˜ê²Œ ë˜ê³ </li>
  <li>Spring SecurityëŠ” sessionì— ì €ì¥ëœ ì¸ì¦í† í°ì´ ìˆìœ¼ë©´ ì‚¬ìš©ìê°€ ì¸ì¦ëœ ì‚¬ìš©ìë¼ê³  ì¸ì¦ì„ ìœ ì§€í•œë‹¤.</li>
</ol>

<p><img src="https://eunmik.github.io/bonita.github.io/assets/img/210611-img3.JPG" /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.core.Authentication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.core.AuthenticationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.web.authentication.AuthenticationFailureHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.web.authentication.AuthenticationSuccessHandler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableWebSecurity</span> <span class="c1">//ì›¹ë³´ì•ˆ í™œì„±í™”ë¥¼ ìœ„í•œ ì–´ë…¸í…Œì´ì…˜</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="n">http</span> <span class="c1">//ì¸ê°€ì •ì±…</span>
                <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span> <span class="c1">//ìš”ì²­ì— ëŒ€í•œ ë³´ì•ˆ ê²€ìƒ‰ì„ í•˜ê³ </span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">();</span> <span class="c1">//ì–´ë–¤ ì¸ì¦ì—ë„ ë³´ì•ˆì„ ë°›ë„ë¡ ì„¤ì •</span>

        <span class="n">http</span> <span class="c1">//ì¸ì¦ì •ì±…</span>
                <span class="o">.</span><span class="na">formLogin</span><span class="o">()</span> <span class="c1">//formLoginë°©ì‹ìœ¼ë¡œ ì¸ì¦ì„ í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •</span>
                <span class="o">.</span><span class="na">loginPage</span><span class="o">(</span><span class="s">"/loginPage"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">defaultSuccessUrl</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span> <span class="c1">//ì¸ì¦ì— ì„±ê³µí–ˆì„ ë•Œ ì´ë™ë˜ëŠ” URL</span>
                <span class="o">.</span><span class="na">failureUrl</span><span class="o">(</span><span class="s">"/login"</span><span class="o">)</span> <span class="c1">//ì¸ì¦ì— ì‹¤íŒ¨ í–ˆì„ ë•Œ</span>
                <span class="o">.</span><span class="na">usernameParameter</span><span class="o">(</span><span class="s">"userId"</span><span class="o">)</span> <span class="c1">//parameter í•­ëª© í•„ë“œ ëª…ì„ ë³€ê²½, default ëŠ” username</span>
                <span class="o">.</span><span class="na">passwordParameter</span><span class="o">(</span><span class="s">"pwd"</span><span class="o">)</span> <span class="c1">//defaultëŠ” password</span>
                <span class="o">.</span><span class="na">loginProcessingUrl</span><span class="o">(</span><span class="s">"/login_proc"</span><span class="o">)</span> <span class="c1">//formíƒœê·¸ì˜ action url, defaultëŠ” login</span>
                <span class="o">.</span><span class="na">successHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">AuthenticationSuccessHandler</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAuthenticationSuccess</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="nc">Authentication</span> <span class="n">authentication</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
                        <span class="c1">//Authentication : ì¸ì¦ì— ì„±ê³µí–ˆì„ ë•Œ ìµœì¢…ì ìœ¼ë¡œ ì¸ì¦í•œ ê²°ê³¼ ê¹Œì§€ ë‹´ì€ ì¸ì¦ê°ì²´</span>
                        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"authentication : "</span> <span class="o">+</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span> <span class="c1">//ì¸ì¦ ì„±ê³µí•œ ì‚¬ìš©ì ì´ë¦„ì„ ì¶œë ¥</span>
                        <span class="n">httpServletResponse</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">"/"</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">})</span> <span class="c1">//loginì— ì„±ê³µ í–ˆì„ ë•Œ successHandlerë¥¼ í˜¸ì¶œ, AuthenticationSuccessHandler ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ êµ¬í˜„ì²´ë¥¼ ì„¤ì •í•˜ë©´ ëœë‹¤.</span>
                <span class="o">.</span><span class="na">failureHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">AuthenticationFailureHandler</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAuthenticationFailure</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="nc">AuthenticationException</span> <span class="n">e</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
                        <span class="c1">//AuthenticationException : ì¸ì¦ ì˜ˆì™¸ì˜ ê°ì²´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ ì£¼ê³  ìˆë‹¤.</span>
                        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"exception : "</span><span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
                        <span class="n">httpServletResponse</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">"/login"</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">})</span>
                <span class="o">.</span><span class="na">permitAll</span><span class="o">()</span> <span class="c1">//loginPageë¡œ ì ‘ê·¼í•˜ëŠ” ëª¨ë“  ì‚¬ìš©ìëŠ” ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë„ë¡ </span>
        <span class="o">;</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="4-form-login-ì¸ì¦-í•„í„°--usernamepasswordauthenticationfilter">4. Form Login ì¸ì¦ í•„í„° : UsernamePasswordAuthenticationFilter</h2>

<p><img src="https://eunmik.github.io/bonita.github.io/assets/img/210611-img4.JPG" /></p>

<ol>
  <li>UserNamePasswordAuthenticationFilter - ì¸ì¦ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•˜ê³  ì¸ì¦ì²˜ë¦¬ì— ê´€ë ¨ëœ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” Filter, ë‚´ë¶€ì ìœ¼ë¡œ ê°ê°ì˜ ì¸ì¦ì²˜ë¦¬ì˜ ì—­í• ì— ë”°ë¼ì„œ ì´ í´ë˜ìŠ¤ë¥¼ í™œìš©í•´ì„œ ì¸ì¦ì²˜ë¦¬ë¥¼ í•˜ê²Œ ëœë‹¤. í˜„ì¬ ì‚¬ìš©ìì˜ ìš”ì²­ ì •ë³´(URL)ë¥¼ í™•ì¸í•œë‹¤.</li>
  <li>AntPathRequestMatcher - í˜„ì¬ ìš”ì²­ì •ë³´ URLì´ â€œ/loginâ€ìœ¼ë¡œ ì‹œì‘ë˜ëŠ”ì§€ ê²€ì‚¬
    <ul>
      <li>SecurityConfigì—ì„œ http.loginProcessingUrlë¡œ ê°’ ë³€ê²½ ê°€ëŠ¥</li>
      <li>Authentication ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ì´ ê°ì²´ ì•ˆì— ì‚¬ìš©ìê°€ ì…ë ¥í•œ usernameê³¼ passwordê°’ì„ ì¸ì¦ê°ì²´ì— ì €ì¥í•´ì„œ ì‹¤ì œë¡œ ì¸ì¦ì²˜ë¦¬ë¥¼ ë§¡ê¸°ëŠ” ì—­í• </li>
    </ul>
  </li>
  <li>AuthenticationManager - Filterë¡œë¶€í„° ì¸ì¦ê°ì²´ë¥¼ ì „ë‹¬ë°›ê³  ì¸ì¦ì²˜ë¦¬ë¥¼ í•˜ê²Œ ëœë‹¤.
    <ul>
      <li>ë‚´ë¶€ì ìœ¼ë¡œ AuthenticationProvider í´ë˜ìŠ¤ íƒ€ì…ì˜ ê°ì²´ë¥¼ ê°€ì§€ê³  ìˆë‹¤. ì´ ê°ì²´ë“¤ ì¤‘ì— í•˜ë‚˜ë¥¼ ì„ íƒ í•´ì„œ ì¸ì¦ì²˜ë¦¬ë¥¼ ìœ„ì„í•˜ê²Œ ëœë‹¤.</li>
      <li>AuthenticationProvider - ì‹¤ì œì ìœ¼ë¡œ ì¸ì¦ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” class, ì¸ì¦ ì‹¤íŒ¨/ì„±ê³µì˜ ê²°ê³¼ë¥¼ return í•œë‹¤. ì‹¤íŒ¨ ê²½ìš°ì— AuthenticationExceptionì„ ë°œìƒ ì‹œí‚¨ë‹¤. ì„±ê³µ ê²½ìš°ì— Userì •ë³´, Authorities ì •ë³´ê°€ ì €ì¥ëœ Authentication ê°ì²´ë¥¼ ë§Œë“¤ê³  ê°ì²´ë¥¼ return í•œë‹¤.</li>
    </ul>
  </li>
  <li>FilterëŠ” ìµœì¢…ì ì¸ Authentication ì¸ì¦ ê°ì²´ë¥¼ SecurityContextì— ì €ì¥í•œë‹¤.
    <ul>
      <li>SecurityContextëŠ” ì¸ì¦ê°ì²´ë¥¼ ë³´ê´€í•˜ëŠ” ì €ì¥ì†Œ/ë³´ê´€ì†Œ ì´ë‹¤.</li>
    </ul>
  </li>
  <li>SecurityContextë¥¼ Sessionì— ì €ì¥ë˜ì–´ì„œ ì „ì—­ì ìœ¼ë¡œ ì‚¬ìš©ìê°€ ì¸ì¦ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì—ì„œ SecurityContext ì•ˆì˜ Authentication ê°ì²´ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.</li>
  <li>ì¸ì¦ì— ì„±ê³µí•œ ì´ í›„ì— SuccessHandler ì‘ì—…ë“¤ì„ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤.</li>
</ol>

<p>SecurityContextê°€ Sessionì—ë„ ì €ì¥</p>

<p><img src="https://eunmik.github.io/bonita.github.io/assets/img/210611-img5.JPG" /></p>

<h2 id="5-logout-ì²˜ë¦¬-logoutfilter">5. Logout ì²˜ë¦¬, LogoutFilter</h2>

<p><img src="https://eunmik.github.io/bonita.github.io/assets/img/210611-img6.JPG" /></p>

<ol>
  <li>í´ë¼ì´ì–¸íŠ¸ê°€ logout ìš”ì²­ì„ í•œë‹¤</li>
  <li>Spring Securityê°€ ê·¸ ìš”ì²­ì„ ë°›ê³  ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬í•œë‹¤.
    <ul>
      <li>ì„¸ì…˜ì„ ë¬´íš¨í™”</li>
      <li>ì¸ì¦ í† í°/ê°ì²´ë¥¼ ì‚­ì œ</li>
      <li>ì¿ í‚¤ì •ë³´ ì‚­ì œ</li>
    </ul>
  </li>
  <li>ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•œë‹¤.</li>
</ol>

<p><img src="https://eunmik.github.io/bonita.github.io/assets/img/210611-img7.JPG" /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableWebSecurity</span> <span class="c1">//WebSecurityConfiguration, SpringWebMvcImportSelector, OAuth2ImportSelector., HttpSecurityConfiguration í´ë˜ìŠ¤ë¥¼ importë°›ì€ annotation</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
                <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">();</span>

        <span class="n">http</span>
                <span class="o">.</span><span class="na">formLogin</span><span class="o">();</span>

        <span class="n">http</span>
                <span class="o">.</span><span class="na">logout</span><span class="o">()</span>
                <span class="o">.</span><span class="na">logoutUrl</span><span class="o">(</span><span class="s">"/logout"</span><span class="o">)</span> <span class="c1">//defaultëŠ” logout, Spring SecurityëŠ” logout ì²˜ë¦¬ë¥¼ í• ë•Œ ê¸°ë³¸ì ìœ¼ë¡œ POSTë°©ì‹ì„ ì‚¬ìš©, GETë°©ì‹ìœ¼ë¡œ ë¡œê·¸ì•„ì›ƒì„ êµ¬í˜„í•˜ê²Œ ë˜ë©´ ì˜¤ë¥˜ë¥¼ ë°œìƒ</span>
                <span class="o">.</span><span class="na">logoutSuccessUrl</span><span class="o">(</span><span class="s">"/login"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addLogoutHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">LogoutHandler</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">logout</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="nc">Authentication</span> <span class="n">authentication</span><span class="o">)</span> <span class="o">{</span>
                        <span class="nc">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">httpServletRequest</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
                        <span class="n">session</span><span class="o">.</span><span class="na">invalidate</span><span class="o">();</span> <span class="c1">//ì„¸ì…˜ì„ ë¬´íš¨í™”</span>
                    <span class="o">}</span>
                <span class="o">})</span> <span class="c1">//ì‹¤ì œë¡œ logoutì„ ì²˜ë¦¬ë¥¼ í•˜ëŠ” logout handlerê°€ ìˆëŠ”ë° ë‹¤ë¥¸ ì‘ì—…ì„ ì›í•  ë•Œ ì§ì ‘ logouthandler interfaceë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.</span>
                <span class="o">.</span><span class="na">logoutSuccessHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">LogoutSuccessHandler</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLogoutSuccess</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="nc">Authentication</span> <span class="n">authentication</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
                        <span class="n">httpServletResponse</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">"/login"</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">})</span> <span class="c1">//ë¡œê·¸ì•„ì›ƒì´ ì„±ê³µí•˜ë©´ ê·¸ ë‹¤ìŒ ìˆ˜í–‰í•  ì‘ì—…, logoutSuccessUrlì€ í˜ì´ì§€ë§Œ ì´ë™í•˜ê³  HandlerëŠ” ë‹¤ì–‘í•œ ë” ë§ì€ ë¡œì§ êµ¬í˜„ ê°€ëŠ¥</span>
                <span class="o">.</span><span class="na">deleteCookies</span><span class="o">(</span><span class="s">"remember-me"</span><span class="o">)</span> <span class="c1">//ì¸ì¦ì„ í• ë•Œ ì„œë²„ì—ì„œ "remember-me" ì¿ í‚¤ë¥¼ ë°œí–‰í•œë‹¤. ë¡œê·¸ì•„ì›ƒí•  ë•Œ serverì—ì„œ ë§Œë“  ì¿ í‚¤ë¥¼ ì‚­ì œí•œë‹¤.</span>
                <span class="o">;</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="https://eunmik.github.io/bonita.github.io/assets/img/210611-img8.JPG" /></p>

<ol>
  <li>LogoutFilterê°€ POSTë°©ì‹ìœ¼ë¡œ ìš”ì²­ ë°›ì•„ì„œ Logout ì²˜ë¦¬ë¥¼ í•œë‹¤.</li>
  <li>AntPathRequestMatcher - í˜„ì¬ ìš”ì²­ì •ë³´ URLì´ â€œ/logoutâ€ìœ¼ë¡œ ì‹œì‘ë˜ëŠ”ì§€ ê²€ì‚¬</li>
  <li>SecurityContextë¡œë¶€í„° ì¸ì¦ê°ì²´ë¥¼ êº¼ë‚´ ì™€ì„œ LogoutHandlerì—ê²Œ ì „ë‹¬í•œë‹¤</li>
  <li>LogoutFilterê°€ ê°€ì§€ê³  ìˆëŠ” ëª‡ê°œì˜ Filterì¤‘ SecurityContextLogoutHandlerëŠ” ì„¸ì…˜ì„ ë¬´íš¨í™”, ì¿ í‚¤ ì‚­ì œ, SecurityContext ê°ì²´ë¥¼ ì‚­ì œí•˜ê³  ì¸ì¦ê°ì²´ë„ nullì²˜ë¦¬ í•œë‹¤.</li>
  <li>Logoutì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ê°€ ë˜ë©´ SimpleUrlLogoutSuccessHandlerë¡œ /loginí˜ì´ì§€ë¥¼ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•˜ë„ë¡ ì²˜ë¦¬ í•œë‹¤.</li>
</ol>

<p><img src="https://eunmik.github.io/bonita.github.io/assets/img/210611-img9.JPG" /></p>

<h2 id="6-remember-me-ì¸ì¦">6. Remember Me ì¸ì¦</h2>

<p><img src="https://eunmik.github.io/bonita.github.io/assets/img/210611-img10.JPG" /></p>

<p><img src="https://eunmik.github.io/bonita.github.io/assets/img/210611-img11.JPG" /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableWebSecurity</span> <span class="c1">//WebSecurityConfiguration, SpringWebMvcImportSelector, OAuth2ImportSelector., HttpSecurityConfiguration í´ë˜ìŠ¤ë¥¼ importë°›ì€ annotation</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="nc">UserDetailsService</span> <span class="n">userDetailsService</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
                <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">();</span>

        <span class="n">http</span>
                <span class="o">.</span><span class="na">formLogin</span><span class="o">();</span>

        <span class="n">http</span>
                <span class="o">.</span><span class="na">logout</span><span class="o">()</span> <span class="c1">//logout ì²˜ë¦¬ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Post ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤.</span>
                <span class="o">.</span><span class="na">logoutUrl</span><span class="o">(</span><span class="s">"/logout"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">logoutSuccessUrl</span><span class="o">(</span><span class="s">"/logout"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addLogoutHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">LogoutHandler</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">logout</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="nc">Authentication</span> <span class="n">authentication</span><span class="o">)</span> <span class="o">{</span>
                        <span class="nc">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">httpServletRequest</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
                        <span class="n">session</span><span class="o">.</span><span class="na">invalidate</span><span class="o">();</span>

                    <span class="o">}</span>
                <span class="o">})</span>
                <span class="o">.</span><span class="na">logoutSuccessHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">LogoutSuccessHandler</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLogoutSuccess</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="nc">Authentication</span> <span class="n">authentication</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
                        <span class="n">httpServletResponse</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">"/login"</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">})</span> <span class="c1">//logoutSuccessUrlì€ urlë¡œ ì´ë™ë§Œ í•˜ì§€ë§Œ handlerëŠ” ë” ë‹¤ì–‘í•˜ê²Œ êµ¬í˜„ ê°€ëŠ¥</span>
                <span class="o">.</span><span class="na">deleteCookies</span><span class="o">()</span>
            <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">rememberMe</span><span class="o">()</span>
                <span class="o">.</span><span class="na">rememberMeParameter</span><span class="o">(</span><span class="s">"remember"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">tokenValiditySeconds</span><span class="o">(</span><span class="mi">3600</span><span class="o">)</span>
                <span class="o">.</span><span class="na">userDetailsService</span><span class="o">(</span><span class="n">userDetailsService</span><span class="o">);</span> <span class="c1">//userê³„ì •ì„ ì¡°íšŒí•˜ëŠ” í´ë˜ìŠ¤ê°€ userDetailService</span>
                <span class="o">;</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="7-remember-me-ì¸ì¦-í•„í„°--remembermeauthenticationfilter">7. Remember Me ì¸ì¦ í•„í„° : RememberMeAuthenticationFilter</h2>

<p><img src="https://eunmik.github.io/bonita.github.io/assets/img/210611-img12.JPG" /></p>

<ol>
  <li>RememberMeAuthenticationFilterëŠ” ì‚¬ìš©ì ìš”ì²­ì„ ë°›ì•„ì„œ ì¸ì¦ì„ ì²˜ë¦¬í•˜ëŠ” ì¡°ê±´ì´ ìˆë‹¤.
    <ul>
      <li>
        <p>Authenticationì´ nullì¼ ê²½ìš°</p>

        <p>ì¸ì¦ì„ ë°›ì€ ì‚¬ìš©ìëŠ” security contextì— ì¸ì¦ê°ì²´ê°€ ì¡´ì¬.</p>

        <p>ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° :</p>

        <ul>
          <li>ì‚¬ìš©ì ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ëŠê²¼ì„ ë•Œ</li>
          <li>security contextê°€ ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— security contextì•ˆì— authenticationì´ ì—†ëŠ” ê²½ìš°</li>
        </ul>
      </li>
      <li>
        <p>Remember-me ì¿ í‚¤ë¥¼ ê°€ì§€ê³  ì˜¨ ê²½ìš°</p>
      </li>
    </ul>

    <p>(Authentication == null &amp;&amp; Serverë¡œë¶€í„° remember-me ì¿ í‚¤ë¥¼ ë°œê¸‰ ë°›ì€ ê²½ìš°) ì´ ê²½ìš°ì— RememberMeAuthenticationFilter ë™ì‘í•œë‹¤.</p>
  </li>
  <li>RememberMeServicesì— êµ¬í˜„ì²´ê°€ ë‘ê°€ì§€ê°€ ìˆë‹¤.
    <ul>
      <li>TokenBasedRememberMeServices : ë©”ëª¨ë¦¬ì— ì‹¤ì œë¡œ ì €ì¥ëœ Tokenê³¼ ì‚¬ìš©ìê°€ ìš”ì²­í•  ë•Œ ê°€ì ¸ì˜¨ ì¿ í‚¤ Tokenê³¼ ë¹„êµí•´ì„œ ì¸ì¦ì²˜ë¦¬</li>
      <li>PersistentTokenBasedRememberMeServices : ì˜êµ¬ì ì¸ ë°©ë²•, DBì— ë°œê¸‰í•œ Tokenì„ ì €ì¥í•˜ê³  ì‚¬ìš©ìê°€ ê°€ì ¸ì˜¨ Token ê°’ê³¼ DBì— ì €ì¥ëœ ê°’ê³¼ ë¹„êµí•´ì„œ ì¸ì¦ì²˜ë¦¬</li>
    </ul>
  </li>
  <li>RememberMeServiceê°€ Token Cookieë¥¼ ì¶”ì¶œí•œë‹¤.</li>
  <li>ê°€ì§€ê³  ìˆëŠ” Tokenì´ Remember-meë¼ëŠ” Tokenì¸ì§€ ê²€ì‚¬í•œë‹¤. Tokenì´ ì¡´ì¬í•˜ë©´ ë‹¤ìŒìœ¼ë¡œ ì§„í–‰í•œë‹¤.</li>
  <li>Decode Tokenì—ì„œ Tokenì´ ì •ìƒì ìœ¼ë¡œ ê·œì¹™ì„ ì§€í‚¤ê³  ìˆëŠ” Tokenì¸ì§€ íŒë‹¨í•œë‹¤. (ì •ìƒìœ ë¬´íŒë‹¨)
    <ul>
      <li>Tokenì´ ì„œë¡œ ì¼ì¹˜í•˜ëŠ” ì§€</li>
      <li>DBì— ì €ì¥ëœ Userë¥¼ ì¡°íšŒí•´ì„œ User ê³„ì •ì´ ì¡´ì¬í•˜ëŠ”ì§€</li>
      <li>ìƒˆë¡œìš´ Authentication (ì¸ì¦ê°ì²´)ë¥¼ ìƒì„±</li>
      <li>AuthenticationManagerì— ì¸ì¦ê°ì²´ë¥¼ ì „ë‹¬</li>
    </ul>
  </li>
</ol>
:ET