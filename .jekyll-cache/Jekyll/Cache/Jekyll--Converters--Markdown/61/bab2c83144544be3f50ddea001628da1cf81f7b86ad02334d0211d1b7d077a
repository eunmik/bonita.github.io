I"š*<p>ë³´ì•ˆì„ ìœ„í•´ì„œ ë¡œê·¸ì¸ íšŸìˆ˜ë¥¼ ì œí•œí•  í•„ìš”ê°€ ìˆë‹¤.</p>

<p>ë¡œê·¸ì¸ íšŸìˆ˜ ì œí•œì„ ìœ„í•´ ê³ ë ¤í•´ì•¼ í•  ì‚¬í•­ì€</p>

<ol>
  <li>ë¡œê·¸ì¸ ì‹œë„ íšŸìˆ˜ë¥¼ ì—°ì† 5íšŒ ì´í•˜ë¡œ ì œí•œ</li>
  <li>ë¡œê·¸ì¸ ì‹œë„ íšŸìˆ˜ ì €ì¥ ìœ„ì¹˜â€¦ ë©”ëª¨ë¦¬ ê°€ëŠ¥? DBì—?</li>
  <li>ë¡œê·¸ì¸ ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ ì‹œ ê³„ì • ì ê¸ˆ (30ë¶„)</li>
  <li>ê°€ì¥ ìµœê·¼ì— ë¡œê·¸ì¸ ì‹¤íŒ¨ ì´í›„ë¡œ 30ë¶„
    <ul>
      <li>ë§Œì•½ ê³„ì •ì´ ì ê²¼ëŠ”ë°ë„ ì‹œë„í•œë‹¤ë©´ ì‹œë„í–ˆì„ ë•Œë¶€í„° ë‹¤ì‹œ 30ë¶„ ë¦¬ì…‹</li>
    </ul>
  </li>
  <li>
    <p>ë¡œê·¸ì¸ ë°ì´í„°ë¥¼ ì €ì¥í•œ DB í…Œì´ë¸”ì„ ë§Œë“¤ì–´ì¤€ë‹¤.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`login_info`</span> <span class="p">(</span>
   <span class="nv">`userid`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="nv">`count`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span><span class="p">,</span>
   <span class="nv">`locked_time`</span> <span class="nb">timestamp</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="nv">`is_locked`</span> <span class="nb">tinyint</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span><span class="p">,</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`userid`</span><span class="p">),</span>
   <span class="k">KEY</span> <span class="nv">`userid`</span> <span class="p">(</span><span class="nv">`userid`</span><span class="p">)</span>
 	<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</code></pre></div>    </div>

    <p>count : ë¡œê·¸ì¸ ì‹œë„ íšŸìˆ˜</p>

    <p>locked_time : ë¡œê·¸ì¸ ì‹œë„ ì œí•œ ì´ˆê³¼ ë˜ì—ˆì„ ë•Œ ë½ ì´ í’€ë¦¬ëŠ” ì‹œê°„</p>

    <p>is_locked : ê³„ì •ì´ ë½ ë˜ì–´ìˆëŠ”ì§€ ì•„ë‹Œì§€  1 = true, 0 = false</p>
  </li>
  <li>
    <p>login Entityë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>

 <span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
 <span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
 <span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
 <span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>
 <span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>

 <span class="nd">@Data</span>
 <span class="nd">@Entity</span>
 <span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"login_info"</span><span class="o">)</span>
 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginInfo</span><span class="o">{</span>
        
     <span class="nd">@Id</span>
     <span class="kd">private</span> <span class="nc">String</span> <span class="n">userid</span><span class="o">;</span>
     <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span><span class="o">;</span>
     <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"locked_time"</span><span class="o">)</span>
     <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">lockedTime</span><span class="o">;</span>
     <span class="nd">@Column</span><span class="o">(</span><span class="n">columnDefinition</span> <span class="o">=</span> <span class="s">"TINYINT"</span><span class="o">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"is_locked"</span><span class="o">)</span>
     <span class="kd">private</span> <span class="nc">Boolean</span> <span class="n">isLocked</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

     <span class="kd">public</span> <span class="nf">LoginInfo</span><span class="o">(){</span>
     <span class="o">}</span>

     <span class="kd">public</span> <span class="nf">LoginInfo</span><span class="o">(</span><span class="nc">String</span> <span class="n">userid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">,</span> <span class="nc">LocalDateTime</span> <span class="n">lockedTime</span><span class="o">,</span> <span class="nc">Boolean</span> <span class="n">isLocked</span><span class="o">){</span>
         <span class="k">this</span><span class="o">.</span><span class="na">userid</span> <span class="o">=</span> <span class="n">userid</span><span class="o">;</span>
         <span class="k">this</span><span class="o">.</span><span class="na">count</span> <span class="o">=</span> <span class="n">count</span><span class="o">;</span>
         <span class="k">this</span><span class="o">.</span><span class="na">lockedTime</span> <span class="o">=</span> <span class="n">lockedTime</span><span class="o">;</span>
         <span class="k">this</span><span class="o">.</span><span class="na">isLocked</span> <span class="o">=</span> <span class="n">isLocked</span><span class="o">;</span>
     <span class="o">}</span>

 <span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Login í•  ë•Œ ë¡œê·¸ì¸ íšŸìˆ˜/ì‹œê°„ì„ í™•ì¸í•œë‹¤.</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">loadUserByUsername</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
             <span class="n">lockedTime</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">getLoginCounts</span><span class="o">().</span><span class="na">getLockedTime</span><span class="o">();</span>
             <span class="n">isLocked</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">getLoginCounts</span><span class="o">().</span><span class="na">getIsLocked</span><span class="o">();</span>
             <span class="k">if</span><span class="o">(</span><span class="n">isLocked</span><span class="o">)</span> <span class="o">{</span>
                 <span class="k">if</span><span class="o">(</span><span class="n">lockedTime</span><span class="o">.</span><span class="na">isAfter</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">())){</span> <span class="c1">//Locked ì‹œê°„ì´ ì§€ë‚˜ì§€ ì•Šì•˜ìœ¼ë©´</span>
                     <span class="n">failReason</span> <span class="o">=</span> <span class="s">"The account is locked."</span><span class="o">;</span>
                     <span class="n">lockedTime</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">plusMinutes</span><span class="o">(</span><span class="mi">30</span><span class="o">);</span>
                     <span class="k">throw</span> <span class="k">new</span> <span class="nf">AccessDeniedException</span><span class="o">(</span><span class="n">failReason</span><span class="o">);</span>
                 <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
                     <span class="n">isLocked</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                     <span class="n">loginAttempts</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                 <span class="o">}</span>

             <span class="o">}</span>
             <span class="n">loginAttempts</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">getLoginCounts</span><span class="o">().</span><span class="na">getCount</span><span class="o">();</span>

             <span class="c1">//ë¡œê·¸ì¸ íšŸìˆ˜ê°€ 5ë²ˆ ì´ìƒì´ë©´ ì•ˆëœë‹¤.</span>
             <span class="k">if</span><span class="o">(</span><span class="n">loginAttempts</span> <span class="o">==</span> <span class="mi">5</span> <span class="o">){</span>
                 <span class="n">failReason</span> <span class="o">=</span> <span class="s">"The maximum number of login attempts."</span><span class="o">;</span>
                 <span class="n">lockedTime</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">plusMinutes</span><span class="o">(</span><span class="mi">30</span><span class="o">);</span>
                 <span class="n">isLocked</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                 <span class="k">throw</span> <span class="k">new</span> <span class="nf">AccessDeniedException</span><span class="o">(</span><span class="n">failReason</span><span class="o">);</span>
             <span class="o">}</span>

 <span class="o">....</span>

 <span class="k">if</span><span class="o">(</span><span class="n">failReason</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">)</span> <span class="o">{</span> <span class="c1">//ë¡œê·¸ì¸ì— ì‹¤íŒ¨ í–ˆë‹¤ë©´</span>
 	<span class="nc">UserLogin</span> <span class="n">ulogin</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserLogin</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(),</span> <span class="n">loginAttempts</span><span class="o">,</span> <span class="n">lockedTime</span><span class="o">,</span> <span class="n">isLocked</span><span class="o">);</span>
   <span class="n">userLoginRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">ulogin</span><span class="o">);</span>
                 <span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ol>
:ET